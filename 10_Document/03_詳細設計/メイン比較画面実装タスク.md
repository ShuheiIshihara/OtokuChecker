# メイン比較画面実装タスク

## 概要
OtokuCheckerアプリのメイン比較画面のUI実装を行います。
ワイヤーフレーム設計に基づき、既存のContentViewを改善し、設計どおりの使いやすい比較画面を実現します。

## 現状分析

### ✅ 既に実装済み
- 基本的な比較機能（ComparisonService）
- 商品入力コンポーネント（ProductInputView）
- 比較結果表示（ComparisonResultView）
- レスポンシブレイアウト（縦横対応）
- デザインシステム（AppColors, ViewModifiers）

### ❌ 不足している機能
- 履歴参照機能（📋ボタンの実装）
- ツールバーアイコンの正しい表示
- エラーハンドリングの改善
- ユーザビリティの向上

## 修正対象ファイル構造

```
20_Source/OtokuChecker/OtokuChecker/
├── ContentView.swift                 # 修正 - メイン画面の改善
├── Views/Components/                 
│   ├── ProductInputView.swift        # 修正 - 履歴参照機能追加
│   └── ComparisonResultView.swift    # 微調整 - UX改善
└── ViewModels/                       # 新規検討
    └── MainComparisonViewModel.swift # 状態管理改善
```

## タスク詳細

### Phase 1: UI/UX改善

#### 1.1 ツールバーアイコン修正
**パス**: `ContentView.swift`

**修正箇所**:
- Line 52: `"chart.bar"` → `"chart.line.uptrend.xyaxis"` （履歴アイコン改善）
- Line 60: `"gearshape"` → `"gear"` （設定アイコン改善）
- ボタンの視覚的フィードバック追加

#### 1.2 エラーハンドリング改善
**パス**: `ContentView.swift`

**修正内容**:
- より詳細なエラーメッセージ
- エラー状態でのユーザーガイダンス
- バリデーション連携の改善

#### 1.3 ユーザビリティ向上
**パス**: `ContentView.swift`

**修正内容**:
- 空白状態での説明テキスト
- 比較実行後のフィードバック改善
- アクセシビリティ対応

### Phase 2: 履歴参照機能実装

#### 2.1 履歴参照コンポーネント作成
**パス**: `Views/Components/HistorySelectionView.swift` (新規)

**内容**:
- 過去の商品記録一覧表示
- 検索・フィルタリング機能
- 選択インターフェース

#### 2.2 ProductInputView拡張
**パス**: `Views/Components/ProductInputView.swift`

**修正内容**:
- 履歴参照ボタンの実装
- 履歴データの表示・選択
- 自動入力機能

#### 2.3 履歴データ連携
**パス**: `ContentView.swift`

**修正内容**:
- 履歴選択時のデータ反映
- 履歴との比較状態管理
- 履歴情報の表示

### Phase 3: 状態管理改善（オプション）

#### 3.1 ViewModel作成
**パス**: `ViewModels/MainComparisonViewModel.swift` (新規)

**内容**:
- 比較状態の管理
- 履歴データの管理
- エラー状態の管理

#### 3.2 ContentView리팩토링
**パス**: `ContentView.swift`

**修正内容**:
- ViewModelベースの状態管理
- UIロジックの分離
- テスタビリティ向上

## 実装優先順位

### 🔥 高優先度（必須実装）
1. **ツールバーアイコン修正** - 視覚的改善
2. **エラーハンドリング改善** - ユーザビリティ向上
3. **空白状態の改善** - 初回利用者への配慮

### 🔶 中優先度（設計要件）
4. **履歴参照UI作成** - 基本的な履歴選択画面
5. **ProductInputView拡張** - 履歴参照ボタン実装
6. **履歴データ連携** - 選択した履歴の反映

### 🔸 低優先度（将来拡張）
7. **ViewModel実装** - アーキテクチャ改善
8. **詳細な履歴機能** - 検索・フィルタリング

## 完了基準

### Phase 1完了基準
- [ ] ツールバーアイコンが適切に表示される
- [ ] エラーメッセージが分かりやすい
- [ ] 初回利用時のガイダンスが表示される
- [ ] アクセシビリティ要件を満たす

### Phase 2完了基準  
- [ ] 履歴参照ボタンから過去データを選択できる
- [ ] 選択した履歴データが商品入力欄に反映される
- [ ] 履歴との比較結果が適切に表示される
- [ ] 履歴機能のエラーハンドリングが完全

### 全体完了基準
- [ ] ワイヤーフレーム設計どおりの見た目と機能
- [ ] ビルドエラーなし
- [ ] 既存テストが通る
- [ ] パフォーマンス劣化なし

## 推定工数

- **Phase 1**: 2-3時間（UI/UX改善）
- **Phase 2**: 4-6時間（履歴参照機能）  
- **Phase 3**: 2-3時間（ViewModel実装）
- **テスト・調整**: 1-2時間

**合計**: 9-14時間程度

## 技術的な注意事項

### 1. 既存機能への影響
- 既存の比較機能を損なわない
- デザインシステム（AppColors, ViewModifiers）を活用
- レスポンシブレイアウトを維持

### 2. データ連携
- Core Dataの履歴データを活用
- ProductRecordとProductGroupの関係性
- パフォーマンス最適化

### 3. ユーザビリティ
- 買い物中の片手操作を考慮
- 30秒以内での比較実行を目標
- 直感的な操作フロー

このタスクにより、ワイヤーフレーム設計に沿った使いやすいメイン比較画面が完成します。